<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard â€¢ Intreen</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
  <header id="site-navbar"></header>
  <main class="flex-grow max-w-5xl mx-auto px-4 py-10 space-y-8">
    <h1 class="text-3xl font-extrabold">Admin Dashboard</h1>

    <section class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm">
      <h2 class="text-xl font-bold mb-2">Initial Setup</h2>
      <p class="text-slate-700">If no admin password exists in the database, set one here.</p>
      <form id="setup-form" class="mt-3 flex gap-2" autocomplete="off">
        <input id="setup-pass" type="password" placeholder="New admin password" class="px-3 py-2 border rounded-xl w-64" required>
        <button class="px-4 py-2 rounded-2xl bg-blue-600 text-white hover:bg-blue-700">Set Password</button>
      </form>
      <p id="setup-status" class="text-sm text-slate-600 mt-2"></p>
    </section>

    <section class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm">
      <h2 class="text-xl font-bold mb-2">Change Password</h2>
      <form id="change-form" class="mt-3 grid sm:grid-cols-3 gap-2" autocomplete="off">
        <input id="old-pass" type="password" placeholder="Current password" class="px-3 py-2 border rounded-xl" required>
        <input id="new-pass" type="password" placeholder="New password" class="px-3 py-2 border rounded-xl" required>
        <button class="px-4 py-2 rounded-2xl bg-blue-600 text-white hover:bg-blue-700">Change</button>
      </form>
      <p id="change-status" class="text-sm text-slate-600 mt-2"></p>
    </section>
  </main>
  <footer class="bg-blue-900 text-white" id="site-footer"></footer>
  <script type="module">
    import { bootLayout } from '/js/layout.js'; bootLayout();

    async function post(url, body){
      const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body||{}) });
      let out = {}; try { out = await res.json(); } catch(e){}
      if (!res.ok) throw new Error(out.error || ('HTTP '+res.status));
      return out;
    }

    document.getElementById('setup-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const pass = document.getElementById('setup-pass').value;
      try { await post('/api/admin/setup', { password: pass }); document.getElementById('setup-status').textContent = 'Password set.'; }
      catch (err) { document.getElementById('setup-status').textContent = err.message; }
    });

    document.getElementById('change-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const oldp = document.getElementById('old-pass').value;
      const newp = document.getElementById('new-pass').value;
      try { await post('/api/admin/change-password', { oldPassword: oldp, newPassword: newp }); document.getElementById('change-status').textContent = 'Changed.'; }
      catch (err) { document.getElementById('change-status').textContent = err.message; }
    });
  </script>
</body>
</html>
